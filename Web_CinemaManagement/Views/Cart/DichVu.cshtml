@model IEnumerable<Web_CinemaManagement.Models.ModelLinq.DICHVU>

@using Web_CinemaManagement.Models.Cart

@{
    Layout = "~/Views/Shared/_LayoutPageEmployee.cshtml";
    ViewBag.Title = "Dịch Vụ Bắp Nước";

    // Logic lấy giỏ hàng
    var cart = Session["Cart"] as Cart;
    if (cart == null)
    {
        cart = new Cart(); // Nếu chưa có, tạo giỏ hàng rỗng
    }

    var cartItems = cart.cart;
    var tongSoLuong = cart.TongSoluongSP();
    var tongTien = cart.TongTien();
}


    <link href="~/wwwroot/css/style_DichVu.css" rel="stylesheet" />


<h1>Chào mừng bạn đến với gian hàng bắp nước</h1>

<div class="container-dichvu">

    <main id="product-section">
        <h2>Thực Đơn Nổi Bật</h2>
        <div id="product-list">

            @foreach (var item in Model)
            {
                <div class="product-card">

                    @{
                        // Sửa lỗi HINH_ANH bị null
                        var hinhAnh = !string.IsNullOrEmpty(item.HINH_ANH)
                                        ? item.HINH_ANH
                                        : "~/wwwroot/Images/logo.png";
                    }

                    <img class="product-image" src="@Url.Content(hinhAnh)" alt="@item.TENSP" />

                    <h3 class="product-name">@item.TENSP</h3>
                    <p class="product-price">@string.Format("{0:N0} VNĐ", item.DONGIA)</p>

                    @Html.ActionLink("+", "AddToCart", "Cart",
                        new { id = item.MASP },
                        new { @class = "add-to-cart-btn" })
                </div>
            }
        </div>
    </main>

    <aside id="cart-sidebar">
        <div class="cart-container">
            <h3>Giỏ Hàng Của Bạn</h3>

            @if (cartItems == null || !cartItems.Any())
            {
                <p class="cart-empty">Giỏ hàng đang trống.</p>
            }
            else
            {
                <table class="cart-table">
                    @foreach (var item in cartItems)
                    {
                        <tr>
                            <td class="cart-item-name">@item.TenSP</td>
                            <td class="cart-item-qty">x @item.SoLuong</td>
                            <td class="cart-item-price">@string.Format("{0:N0}", item.ThanhTien)</td>
                            <td class="cart-item-remove">
                                @Html.ActionLink("X", "RemoveFromCart", "Cart", new { id = item.MaSP }, new { @class = "remove-btn" })
                            </td>
                        </tr>
                    }
                </table>

                <hr />

                <div class="cart-summary">
                    <div>
                        <strong>Tổng số lượng:</strong>
                        <span>@tongSoLuong</span>
                    </div>
                    <div>
                        <strong>Tổng tiền:</strong>
                        <span class="total-price">@string.Format("{0:N0} VNĐ", tongTien)</span>
                    </div>
                </div>

                <a href="#" class="checkout-btn">Thanh Toán</a>
            }
        </div>
    </aside>

</div>