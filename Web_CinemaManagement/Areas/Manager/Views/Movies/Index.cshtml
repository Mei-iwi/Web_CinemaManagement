@{
    ViewBag.Title = "Quản lý tổng hợp Phim";
    Layout = "~/Areas/Manager/Views/Shared/_Layout.cshtml";

    // Ép kiểu dữ liệu từ ViewBag
    var danhSachPhim = ViewBag.DanhSachPhim as List<Web_CinemaManagement.Models.ModelLinq.PHIM>;
    var danhSachTheLoai = ViewBag.DanhSachTheLoai as List<Web_CinemaManagement.Models.ModelLinq.THELOAIPHIM>;
    var danhSachDangPhim = ViewBag.DanhSachDangPhim as List<Web_CinemaManagement.Models.ModelLinq.DANGPHIM>;
}

<div class="container-fluid" style="padding-top: 20px;">

    <h2>Quản lý tổng hợp</h2>

    @if (ViewBag.ErrorMessage != null)
    {
        <div class="alert alert-danger">
            <strong>Lỗi!</strong> @ViewBag.ErrorMessage
        </div>
    }

    <p>Trang quản lý Phim, Thể loại và Dạng phim.</p>

    <p>
        @Html.ActionLink("Thêm Phim Mới", "CreatePhim", "Movies", new { area = "Manager" }, new { @class = "btn btn-primary" })
        @Html.ActionLink("Thêm Thể Loại", "CreateTheLoai", "Movies", new { area = "Manager" }, new { @class = "btn btn-info" })
        @Html.ActionLink("Thêm Dạng Phim", "CreateDangPhim", "Movies", new { area = "Manager" }, new { @class = "btn btn-success" })
    </p>

    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">Danh sách Phim (@danhSachPhim.Count)</h3>
                </div>
                <div class="panel-body" style="overflow-x:auto;">
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr class="info">
                                <th>Mã Phim</th>
                                <th>Tên phim</th>
                                <th>Hình ảnh</th>
                                <th>Thể loại</th>
                                <th>Dạng phim</th>
                                <th>Trạng thái</th>
                                <th>Thời lượng</th>
                                <th>Nhà SX</th>
                                <th>Ngày Khởi Chiếu</th>
                                <th>Ngày Kết Thúc</th>
                                <th>Ngày Cập Nhật</th>
                                <th style="width: 120px;"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in danhSachPhim)
                            {
                                <tr>
                                    <td>@item.MAPHIM</td>
                                    <td><strong>@item.TENPHIM</strong></td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(item.HINH_ANH))
                                        {
                                            <img src="@Url.Content(item.HINH_ANH)" width="80" alt="Hình ảnh" />
                                        }
                                        else
                                        {
                                            <span class="text-muted">(Chưa có ảnh)</span>
                                        }
                                    </td>
                                    <td>@item.THELOAIPHIM.TENTHELOAI</td>
                                    <td>@item.DANGPHIM.DANGPHIM1</td>
                                    <td>
                                        <span class="label label-default">@item.DANGPHIM.TrangThai</span>
                                    </td>
                                    <td>
                                        @((item.THOILUONG.HasValue ? item.THOILUONG.Value.TotalMinutes : 0)) phút
                                    </td>
                                    <td>@item.NHASX</td>
                                    <td>@string.Format("{0:dd/MM/yyyy}", item.NGAYKHOICHIEU)</td>
                                    <td>@string.Format("{0:dd/MM/yyyy}", item.NGAYKETTHUC)</td>
                                    <td>@string.Format("{0:g}", item.NGAYCAPNHAT)</td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            @Html.ActionLink("Sửa", "EditPhim", "Movies", new { area = "Manager", id = item.MAPHIM }, new { @class = "btn btn-warning" })
                                            @Html.ActionLink("Xóa", "DeletePhim", "Movies", new { area = "Manager", id = item.MAPHIM }, new { @class = "btn btn-danger" })
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title">Danh sách Thể Loại (@danhSachTheLoai.Count)</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Mã Thể Loại</th>
                                <th>Tên Thể Loại</th>
                                <th class="text-right"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in danhSachTheLoai)
                            {
                                <tr>
                                    <td>@item.MATHELOAI</td>
                                    <td>@item.TENTHELOAI</td>
                                    <td class="text-right" style="width: 100px;">
                                        <div class="btn-group btn-group-xs">
                                            @Html.ActionLink("Sửa", "EditTheLoai", "Movies", new { area = "Manager", id = item.MATHELOAI }, new { @class = "btn btn-warning" })
                                            @Html.ActionLink("Xóa", "DeleteTheLoai", "Movies", new { area = "Manager", id = item.MATHELOAI }, new { @class = "btn btn-danger" })
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="panel panel-success">
                <div class="panel-heading">
                    <h3 class="panel-title">Danh sách Dạng Phim (@danhSachDangPhim.Count)</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Mã Dạng Phim</th>
                                <th>Tên Dạng Phim</th>
                                <th>Trạng Thái</th>
                                <th class="text-right"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in danhSachDangPhim)
                            {
                                <tr>
                                    <td>@item.MADP</td>
                                    <td>@item.DANGPHIM1</td>
                                    <td><span class="label label-default">@item.TrangThai</span></td>
                                    <td class="text-right" style="width: 100px;">
                                        <div class="btn-group btn-group-xs">
                                            @Html.ActionLink("Sửa", "EditDangPhim", "Movies", new { area = "Manager", id = item.MADP }, new { @class = "btn btn-warning" })
                                            @Html.ActionLink("Xóa", "DeleteDangPhim", "Movies", new { area = "Manager", id = item.MADP }, new { @class = "btn btn-danger" })
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>